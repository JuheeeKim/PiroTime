{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/mypage/profile_edit.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Hubballi&display=swap" rel="stylesheet">
<style>
    @media screen and (max-width: 768px) {
        .form-container {
            width: 600px; /* 화면 크기 대비 90% 너비 */
        }

        .form-input, .form-textarea {
            padding: 12px;
            font-size: 1rem; /* 폰트 크기를 조금 더 키워 가독성 향상 */
        }

        .form-button {
            padding: 15px;
            font-size: 1rem; /* 버튼의 크기를 조금 더 키움 */
        }

        .upload-label {
            width: 120px;
            height: 120px; /* 이미지 업로드 버튼의 크기를 확대 */
        }

        .remove-image {
            font-size: 1rem; /* 삭제 버튼의 크기를 키워 클릭하기 쉽게 */
        }
    }

    @media screen and (max-width: 480px) {
        .form-container {
            width: 400px; /* 작은 화면에서는 너비를 100%로 설정 */
            padding: 15px; /* 패딩을 줄여서 화면에 더 잘 맞추기 */
        }

        .upload-label {
            width: 100px;
            height: 100px; /* 작은 화면에서는 이미지 업로드 버튼 크기 줄임 */
        }
    }
</style>
<div class="form-container">
    <div class="logo">
        <img src="{% static 'images/logo.svg' %}" alt="PiroTime Logo" width="170" height="170">
        <h1>PiroTime</h1>
    </div>

    <form method="post" action="{% url 'mypage:profile_edit' %}" enctype="multipart/form-data">
        {% csrf_token %}

        <div class="form-group">
            <label for="id_username">사용자 이름</label>
            {{ form.username }}
            {% if form.username.errors %}
                <div class="error">{{ form.username.errors }}</div>
            {% endif %}
        </div>

        <div class="form-group">
            <label for="id_email">이메일 주소</label>
            {{ form.email }}
            {% if form.email.errors %}
                <div class="error">{{ form.email.errors }}</div>
            {% endif %}
        </div>

        <div class="form-group">
            <label for="id_nickname">닉네임</label>
            {{ form.nickname }}
            {% if form.nickname.errors %}
                <div class="error">{{ form.nickname.errors }}</div>
            {% endif %}
        </div>

        <div class="form-group image-upload">
            <div class="image-label-wrapper">
                <span>프로필 이미지 (선택)</span>
                <button type="button" class="remove-image" onclick="removeImage()" style="display: none;">이미지 삭제</button>
            </div>
            <label for="id_profile_image" class="upload-label">
                {% if user.profile_image %}
                    <img id="image-preview" src="{{ user.profile_image.url }}" alt="프로필 이미지 미리보기" class="profile-image">
                {% else %}
                    <i class="fas fa-camera"></i>
                    <img id="image-preview" alt="프로필 이미지 미리보기" style="display: none;">
                {% endif %}
            </label>
            <input type="file" name="profile_image" id="id_profile_image" accept="image/*" class="form-input--img" onchange="previewImage(event)">
        </div>
        {% if form.profile_image.errors %}
            <div class="error">{{ form.profile_image.errors }}</div>
        {% endif %}

        <div class="form-group">
            <label for="id_cohort">기수</label>
            {{ form.cohort }}
            {% if form.cohort.errors %}
                <div class="error">{{ form.cohort.errors }}</div>
            {% endif %}
        </div>

        <div class="form-group">
            <label for="id_intro">소개</label>
            {{ form.intro }}
            {% if form.intro.errors %}
                <div class="error">{{ form.intro.errors }}</div>
            {% endif %}
        </div>

        <button type="submit" class="form-button">저장</button>
    </form>
</div>

<script>
    function previewImage(event) {
        console.log('previewImage called'); // 함수가 호출되는지 확인
        const reader = new FileReader();
        reader.onload = function() {
            const output = document.getElementById('image-preview');
            const cameraIcon = document.querySelector('.upload-label i');
            const removeBtn = document.querySelector('.remove-image');
            output.src = reader.result;
            output.style.display = 'block';
            cameraIcon.style.display = 'none';
            removeBtn.style.display = 'inline-block';
            console.log('Image loaded:', reader.result); // 이미지가 제대로 로드되었는지 확인
        }
        reader.readAsDataURL(event.target.files[0]);
    }

    function removeImage() {
        const output = document.getElementById('image-preview');
        const cameraIcon = document.querySelector('.upload-label i');
        const removeBtn = document.querySelector('.remove-image');
        const fileInput = document.getElementById('id_profile_image');

        output.src = '';
        output.style.display = 'none';
        cameraIcon.style.display = 'block';
        removeBtn.style.display = 'none';
        fileInput.value = '';  // 파일 선택 초기화
    }

    // 프로필 이미지가 있으면 삭제 버튼을 표시
    window.onload = function() {
        const output = document.getElementById('image-preview');
        const removeBtn = document.querySelector('.remove-image');
        if (output.src) {
            removeBtn.style.display = 'inline-block';
        }
    }
</script>
{% endblock %}
